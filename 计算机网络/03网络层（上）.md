# 网络层（上）

## 4.1网络层的功能

网络层的主要任务是将分组从源端传送到目的端，为分组交换网上的不同主机提供通信服务。网络层的传输单位是数据报（数据报是分组的父级单位）

### 功能1：路由选择与分组转发

路由器的两个功能也是路由选择（确认哪一条路径）和分组转发（分组到达后采取的动作）

具体的   路由选择是根据分布式算法得到网络动态拓扑情况，动态的改变所选的路由

​              分组转发是路由器根据**转发表**将用户的数据报从合适的端口转出去

#### 路由算法

路由器转发分组是通过路由表转发的，路由表又是根据各种算法得到的，其中算法可分为静态路由算法和动态路由算法

静态路由算法：根据网络管理员手动配置的路由信息，网络拓扑结构或链路状态变化需要手动修改，好处是简单方便，适合稳定拓扑和变化不大的网络

动态路由算法：根据路由器之间交换的信息根据一定算法优化出来的，会不断更新。有距离向量路由算法（例如RIP算法）或链路状态路由算法（OSPF）

#### 层次路由

网络规模扩大时，路由表的规模也是成比例扩大。因此路由选择按层级进行。按层次将互联网分为许多较小的自治系统，系统决定内部采用何种路由协议。有外部协议（自治系统之间）和内部协议（自治系统内部）



### 功能2：异构网络互连

### 功能3：拥塞控制

在通信子网中，因出现过量的分组而导致网络性能下降的现象叫拥塞。例如，某分组到达路由的速度接近其带宽，会极大的增大其时延，同时导致一部分分组被丢弃。

观察网络是否进入拥塞状态的方法是，观察**网络的吞吐量和平均负载**的关系。如果网络吞吐量随着负载的增加而下降就是拥塞

流量控制和拥塞控制的区别：流量控制是在数据链路层中，控制发送端的数据，让接收端能来得及接受

​                                                  拥塞控制是全局性的问题，确保通信子网能传输待传输的数据

##### 拥塞控制的两种方法：

静态的开环控制：设计网络前预先考虑所有问题，系统一旦启动则不再修改

动态的闭环控制：事先不考虑任何的拥塞的因素，系统启动后通过监听来调整



# 4.2 IPv4

![](D:\gigigi\learnNotes\计算机网络\image\网络层01.png)

IP分组也就是IP数据报，分为**首部**和**数据**（例如TCP、UDP数据段）两部分

其中首部的部分重要字段含义如下：

（加固一下记忆，1位=1比特，1字节=8比特

   首部部分通常有5段固定组成和1段可选组成，每一段为32位，即32比特或4字节，故首部部分通常是等于或者大于5*4字节）

1.版本号，一般为4

2.首部长度，占4位（理论上只能表示最大数为15），但是单位是4个字节，所以最大能表示60字节的长度。一般来说，IP4的首部长度都是20字节，也就是说首部长度域所表示的数字为5

3.生存时间（TTL），占8位，表示数据报在网络中能通过的最大数

4.总长度，占16位，单位是字节，表示首部和数据之和的长度

5.协议，占8位，指出该分组携带的数据用何协议，即分组的数据部分应交给哪个传输层协议，如TCP、UCP等。其中6表示TCP,17表示UCP

下面开始有点重要了

首先介绍MTU，这是数据报能传输的最大单元

1.标志 占3位 ，其中后两位有意义，第二位是DF(don't fragment)，第三位是MF（more）,DF=0,代表有分片MF=0代表这是分片的最后一个，MF=1代表后面还有分片

2.片偏移字段占13位， 特别要注意的是片偏移字段是8字节（首部长度，总长度，片偏移分别为4，1，8字节）

![](D:\gigigi\learnNotes\计算机网络\image\网络层02.jpg)

![](D:\gigigi\learnNotes\计算机网络\image\网络层03.jpg)

![](D:\gigigi\learnNotes\计算机网络\image\网络层04.jpg)